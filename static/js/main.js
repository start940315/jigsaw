/*
 frontend powered By Startan
 Designed By xiang
 producted By fei
 */
function getHost(){return HOST&&HOST.length?HOST:(HOST=window.location,HOST=HOST.protocol+"//"+HOST.host+"/"+GAMEID,HOST.indexOf("file")>=0&&(HOST="."),HOST)}!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16.7-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var Transitionend="ontransitionend"in window?"transitionend":"webkitTransitionEnd",GAMEID=10000190,HOST=getHost();Zepto(function(a){function b(a,b,c){this.str="<div class='frag' 		style=' 		width: "+b+"px; 		height: "+b+"px; 		background-image: url(./static/img/winnie"+i.imgIndex+".jpg); 		background-position: -"+a%c*b+"px -"+Math.floor(a/c)*b+"px; 		-webkit-transform: translateX(0) translateY(0); 		transform: translateX(0) translateY(0); 		left: "+a%c*b+"px; 		top: "+Math.floor(a/c)*b+"px; 		' 		data-index='"+a+"' 		></div>",this.oriX=a%c*b,this.oriY=Math.floor(a/c)*b,this.offsetX=0,this.offsetY=0,this.startX=0,this.startY=0,this.linkList=[a],this.el=null,this.faEl=null,this.topIndex=a}var d={ready:function(){a(".select").removeClass("select"),a("h2").one(Transitionend,function(){setTimeout(function(){a(".container").addClass("show-btn")},50)}),a(".container").removeClass("step1 step3 show-ctr").addClass("step2"),d.state[0]=!1,d.state[1]=!1,m.play("oui"),a(".mode-btn-wr").on("touchstart",".btn",function(b){var c=a(b.target);m.play("oui"),c.hasClass("large")?(a(".large .select").removeClass("select"),c.addClass("select"),d.mode=+c.data("mode"),d.state[0]=!0,2===d.mode&&(d.difficulty=1,d.state[1]=!0)):(a(".small .select").removeClass("select"),c.addClass("select"),d.difficulty=+c.data("difficulty"),d.state[1]=!0),d.finish()&&i.fire()})},state:[!1,!1],mode:-1,difficulty:-1,setDom:function(){var b="",c="";switch(d.mode){case 1:b="限时模式";break;case 2:b="进阶模式";break;case 3:b="计时模式"}if(2!==d.mode)switch(d.difficulty){case 1:c="低能";break;case 2:c="中能";break;case 3:c="高能"}a(".game-ctr .game-mode").html("<span class='m'>"+b+"</span><span class='d'>"+c+"</span>")},finish:function(){var a=d.state;return a[0]&&a[1]}},e={w:a(window).width(),h:a(window).height()};try{yw.init({gameId:GAMEID,width:e.w,height:e.h})}catch(f){alert(f.message)}var g=b.prototype;g.move=function(a,b){this.offsetX=this.startX+a,this.offsetY=this.startY+b;for(var c=this.linkList,d=i.frags,e=0,f=c.length;f>e;e++)d[c[e]].offsetX=this.offsetX,d[c[e]].offsetY=this.offsetY;return{x:this.offsetX,y:this.offsetY}},g.isLinked=function(b){return-1!==a.inArray(b,this.linkList)},g.link=function(b,c){var d=this.linkList;d=d.concat(b[c].linkList);{var e,f,g=null,h=null,j=null,k=a("<div class='frag-group'></div>");this.topIndex}for(k.css({"-webkit-transform":"translateX("+this.offsetX+"px) translateY("+this.offsetY+"px)",transform:"translateX("+this.offsetX+"px) translateY("+this.offsetY+"px)"}),h=this.faEl,j=b[c].faEl,e=0,f=d.length;f>e;e++)g=b[d[e]],g.faEl||g.el.css({"-webkit-transform":"none",transform:"none"}),k.append(g.el),g.linkList=d,g.faEl=k,g.topIndex=this.topIndex;return h&&h.remove(),j&&j.remove(),k.appendTo(i.wr),this.top(++i.moveElId),d.length},g.top=function(a){if(this.faEl){this.faEl.css({"z-index":a});for(var b=0,c=this.linkList.length;c>b;b++)i.frags[this.linkList[b]].topIndex=a}else this.el.css({"z-index":a}),this.topIndex=a},g.isTop=function(){for(var a=0,b=i.frags.length;b>a;a++)if(i.frags[a].topIndex>this.topIndex&&Math.abs(i.frags[a].offsetX+i.frags[a].oriX-this.offsetX-this.oriX)<i.size-2&&Math.abs(i.frags[a].offsetY+i.frags[a].oriY-this.offsetY-this.oriY)<i.size-2)return!1;return!0};var h={el:a(".game-ctr .timer .value"),limit:0,timeId:0,result:0,reset:function(){if(h.el.text("00:00"),1===d.mode)switch(d.difficulty){case 1:h.limit=22;break;case 2:h.limit=180;break;case 3:h.limit=600}},normalize:function(a){var b=Math.floor(a/60),c=a%60;return b=("0"+b).substr(-2),c=("0"+c).substr(-2),b+":"+c},setDom:function(a){"string"!=typeof a&&(a=h.normalize(a)),h.el.text(a)},countDown:function(a,b){function c(){h.setDom(a),a--,h.result=a,0>a?b&&b():h.timeId=setTimeout(c,1e3)}clearTimeout(h.timeId),h.timeId=setTimeout(c,1e3)},count:function(a){function b(){h.setDom(c),c++,h.result=c,h.timeId=setTimeout(b,1e3)}var c=a?a:0;clearTimeout(h.timeId),h.timeId=setTimeout(b,1e3)},con:function(){this.count(h.result)},stop:function(){clearTimeout(h.timeId)}},i={wr:a(".frag-wr"),imgIndex:1,moveElId:111,frags:[],col:0,row:0,size:0,nowDi:0,fire:function(){i.nowDi=d.difficulty,h.reset(),i.wr.css("margin-top",(e.h-460)/2+"px"),i.ready(),a(".mode-btn-wr .btn").eq(5).one(Transitionend,function(){setTimeout(function(){i.wr.one(Transitionend,function(){a(".container").addClass("show-ctr")}),a(".container").addClass("step3").removeClass("step2")},10)}),a(".container").removeClass("show-btn")},ready:function(){function b(){c.text(d+"秒钟记图"),d--,0>d?(i.getDom(),i.messup()):setTimeout(b,1e3)}i.frags=[],i.moveModule.list=[],i.moveArr=[],i.imgIndex=i.nowDi,i.generateView();var c=a(".game-ctr .game-mode"),d=5;b()},messup:function(){rx=0,ry=0,c=0,r=0,col=i.col,row=i.row,size=i.size,frags=i.frags,pos={},i.wr.addClass("ready"),d.setDom(),frags[0].el.one(Transitionend,function(){i.wr.removeClass("ready"),i.bind(),1===d.mode?h.countDown(h.limit,i.fail):2===d.mode&&1===i.nowDi||3===d.mode?h.count():2===d.mode&&h.con(h.result)});for(var a=0,b=frags.length;b>a;a++)c=a%col,r=Math.floor(a/col),rx=Math.random()*(300-size),ry=Math.random()*(400-size),pos=frags[a].move(rx-c*size,ry-r*size),frags[a].el.css({"-webkit-transform":"translate3d("+pos.x+"px, "+pos.y+"px, 0)",transform:"translate3d("+pos.x+"px, "+pos.y+"px, 0)"});setTimeout(i.loop,0)},getDom:function(){for(var b=a(".frag-wr .frag"),c=i.frags,d=0,e=c.length;e>d;d++)c[d].el=b.eq(d)},generateView:function(){i.wr.empty();var a=0,c=i.nowDi;1===c?a=12:2===c?a=48:3===c&&(a=108);var d,e=100/c,f="",g=0,h=3*c;for(i.size=e,i.col=h,i.row=i.col/3*4;a>g;)d=new b(g,e,h),i.frags.push(d),f+=d.str,g++;i.wr.append(f)},bind:function(){var b=i.wr;b.on("touchstart",".frag",function(a){if(i.moveModule.list.length>0)return void a.preventDefault();var b=a.touches[0];i.moveModule.add(b.target,b.clientX,b.clientY,++i.moveElId,b.identifier)}),b.on("touchmove",".frag",function(a){var b=a.touches[0];i.moveModule.move(b.target,b.clientX,b.clientY,b.identifier)}),b.on("touchend touchcancel",".frag",function(){i.moveModule.remove()}),a(".game-ctr .back").one("touchstart",function(){confirm("确定返回吗？")&&(i.destroy(),d.ready())})},unbind:function(){i.wr.off(),a(".game-ctr .back").off()},detectCat:function(a){for(var b=(i.size,a%i.col),c=Math.floor(a/i.col),d=-1,e=-1,f=[[-1,0],[0,1],[1,0],[0,-1]],g=i.frags,h=1e4,j=1e4,k=-1,l=!1,n=0,o=f.length;o>n;n++)if(e=c+f[n][0],d=b+f[n][1],e>=0&&e<i.row&&d>=0&&d<i.col&&!g[a].isLinked(k=e*i.col+d)&&g[k].isTop()&&(h=Math.abs(g[k].offsetX-g[a].offsetX),j=Math.abs(g[k].offsetY-g[a].offsetY),5>h&&5>j)){if(g[a].link(g,k)===i.frags.length)return i.pass(),!0;m.play("oui"),l=!0}return!1},drawIndex:-1,drawId:0,pos:null,draw:function(a,b){var c=i.frags[a].faEl||i.frags[a].el;c.css({"-webkit-transform":"translate3d("+b.x+"px, "+b.y+"px, 0)",transform:"translate3d("+b.x+"px, "+b.y+"px, 0)"})},moveArr:{},loop:function(){function a(a){for(f=a%i.col,g=Math.floor(a/i.col),l=1e4,n=1e4,o=-1,p=0,q=k.length;q>p;p++)if(j=g+k[p][0],h=f+k[p][1],j>=0&&j<i.row&&h>=0&&h<i.col&&!d[a].isLinked(o=j*i.col+h)&&d[o].isTop()&&(l=Math.abs(d[o].offsetX-d[a].offsetX),n=Math.abs(d[o].offsetY-d[a].offsetY),5>l&&5>n)){if(d[a].link(d,o)===d.length)return i.pass(),!0;m.play("oui")}return!1}function b(){i.drawId=requestAnimationFrame(b),e.valid&&(c=d[e.index].move(e.ox,e.oy),a(e.index),i.draw(e.index,c),setTimeout(function(){e.valid=!1},0))}var c,d=i.frags,e=i.moveArr,f=(i.size,0),g=0,h=-1,j=-1,k=[[-1,0],[0,1],[1,0],[0,-1]],l=1e4,n=1e4,o=-1,p=0,q=0;b()},moveModule:{list:[],add:function(b,c,d,e,f){var g=i.moveModule.list;if(!g.length){var h=+a(b).data("index"),j=i.frags[h];j.top(e+1),j.startX=j.offsetX,j.startY=j.offsetY,g[0]={tar:b,x:c,y:d,id:e,tid:f,index:h}}},move:function(a,b,c,d){var e=i.moveModule.list,f=-1;d==e[0].tid&&(f=e[0].index,i.moveArr.index=f,i.moveArr.ox=b-e[0].x,i.moveArr.oy=c-e[0].y,i.moveArr.valid=!0)},remove:function(){i.moveModule.list=[]}},fail:function(){i.destroy(),j.show("so sad...时间已到~",1),m.play("fail")},pass:function(){i.destroy(),2===d.mode&&i.nowDi<3?(i.nowDi++,requestAnimationFrame(function(){i.ready()})):j.show("通关成功！",2),m.play("pass")},destroy:function(){i.unbind(),h.stop(),cancelAnimationFrame(i.drawId)}};a("body").on("touchmove",function(a){a.preventDefault()}),a("#start-btn").one("touchstart",d.ready);for(var j={el:a(".pop"),textel:a(".pop").find(".pop-card .text-wr"),btn:a(".pop .btn-wr"),show:function(a,b,c){if(j.textel.text(a),j.el.addClass("show"),"number"!=typeof b)j.hideBtn(),j.el.one("touchstart",function(){j.hide()}),c=b;else{j.showBtn();var d=j.btn.find("button");1===b?d.eq(0).text("找人帮忙"):2===b&&d.eq(0).text("低调秀一下"),j.bindBtn(b)}},hide:function(){j.el.removeClass("show")},hideBtn:function(){j.btn.css("display","none")},showBtn:function(){j.btn.css("display","block")},bindBtn:function(b){j.btn.on("touchstart",function(c){var e=c.target;if(a(e).hasClass("replay"))d.ready(),j.hide();else{if(!a(e).hasClass("share"))return;l.show(b,h.result)}})}},k={shareImageUrl:HOST+"/static/img/icon.jpg",bgs:[HOST+"/static/img/winnie1.jpg",HOST+"/static/img/winnie2.jpg",HOST+"/static/img/winnie3.jpg"]},l={data:{title:"拼出维尼熊",text:"我正在拼维尼熊，啊~！好喜欢维尼熊~",imageUrl:k.shareImageUrl},shareTpl:[{title:"拼出维尼熊",text:"So sad...我没能把高能维尼熊拼出来，求助大神~",imageUrl:k.shareImageUrl},{title:"拼出维尼熊",text:"So sad...我竟没能把中能维尼熊拼出来，求助大神~",imageUrl:k.shareImageUrl},{title:"拼出维尼熊",text:"So sad...我连低能维尼熊都没拼出来，我面壁去了",imageUrl:k.shareImageUrl},{title:"拼出维尼熊",text:"我在计时模式中拼出了$difficulty$的维尼熊，还剩$time$秒哦！",imageUrl:k.shareImageUrl},{title:"拼出维尼熊",text:"呕液~我花了$time$秒成功拼出了$difficulty$的维尼熊~求超越~",imageUrl:k.shareImageUrl},{title:"拼出维尼熊",text:"我花了$time$秒完成了进阶模式的维尼熊拼图，速来膜拜~",imageUrl:k.shareImageUrl}],show:function(a,b){a&&0!==a?1===a?l.setData(1):2===a&&l.setData(2,b):l.setData(0),yw.openSocialShareMenu(l.data,function(a,b){a&&j.show(b.toString())})},setData:function(b){var c={};if(0===b)a.extend(!0,c,l.shareTpl[0]);else if(1===b)switch(d.difficulty){case 1:a.extend(!0,c,l.shareTpl[1]);break;case 2:a.extend(!0,c,l.shareTpl[2]);break;case 3:a.extend(!0,c,l.shareTpl[3])}else if(2===b){switch(d.mode){case 1:a.extend(!0,c,l.shareTpl[4]);break;case 2:a.extend(!0,c,l.shareTpl[5]);break;case 3:a.extend(!0,c,l.shareTpl[6])}var e="";switch(d.difficulty){case 1:e="低能";break;case 2:e="中能";break;case 3:e="高能"}c.text=c.text.replace(/\$difficulty\$/g,e).replace(/\$time\$/g,h.result)}l.data=c}},m={playing:"",tracks:{oui:a("#audio-oui").get(0),fail:a("#audio-fail").get(0),pass:a("#audio-pass").get(0)},play:function(a){m.playing===a&&m.pause(),m.playing=a,m.tracks[a].play()},pause:function(){m.playing.length&&m.tracks[m.playing].pause()&&(m.tracks[m.playing].currentTime=0)}},n=0,o=k.bgs.length;o>n;n++)a(".preload").append("<img src='"+k.bgs[n]+"'>")});