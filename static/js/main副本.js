/*
 frontend powered By Startan
 Designed By xiang
 producted By fei
 */
function getHost(){return HOST&&HOST.length?HOST:(HOST=window.location,HOST=HOST.protocol+"//"+HOST.host+"/"+GAMEID,HOST.indexOf("file")>=0&&(HOST="."),HOST)}!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16.7-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var Transitionend="ontransitionend"in window?"transitionend":"webkitTransitionEnd",GAMEID=10000190,HOST=getHost();Zepto(function(a){function b(a,b,c){this.str="<div class='frag' \n		style=' 		width: "+b+"px; 		height: "+b+"px; 		background-image: url(./static/img/winnie"+j.imgIndex+".jpg); 		background-position: -"+a%c*b+"px -"+Math.floor(a/c)*b+"px; 		-webkit-transform: translateX(0) translateY(0); 		transform: translateX(0) translateY(0); 		left: "+a%c*b+"px; 		top: "+Math.floor(a/c)*b+"px; 		' 		data-index='"+a+"' 		></div>",this.oriX=a%c*b,this.oriY=Math.floor(a/c)*b,this.offsetX=0,this.offsetY=0,this.startX=0,this.startY=0,this.linkList=[a]}var d={ready:function(){a(".select").removeClass("select"),a("h2").one(Transitionend,function(){setTimeout(function(){a(".container").addClass("show-btn")},50)}),a(".container").removeClass("step1 step3 show-ctr").addClass("step2"),d.state[0]=!1,d.state[1]=!1,n.play("oui"),a(".mode-btn-wr").on("touchstart",".btn",function(b){var c=a(b.target);n.play("oui"),c.hasClass("large")?(a(".large .select").removeClass("select"),c.addClass("select"),d.mode=+c.data("mode"),d.state[0]=!0,2===d.mode&&(d.difficulty=1,d.state[1]=!0)):(a(".small .select").removeClass("select"),c.addClass("select"),d.difficulty=+c.data("difficulty"),d.state[1]=!0),d.finish()&&j.fire()})},state:[!1,!1],mode:-1,difficulty:-1,setDom:function(){var b="",c="";switch(d.mode){case 1:b="限时模式";break;case 2:b="进阶模式";break;case 3:b="计时模式"}if(2!==d.mode)switch(d.difficulty){case 1:c="低能";break;case 2:c="中能";break;case 3:c="高能"}a(".game-ctr .game-mode").html("<span class='m'>"+b+"</span><span class='d'>"+c+"</span>")},finish:function(){var a=d.state;return a[0]&&a[1]}},e={w:a(window).width(),h:a(window).height()};try{yw.init({gameId:GAMEID,width:e.w,height:e.h})}catch(f){alert(f.message)}var g=b.prototype;g.move=function(a,b){this.offsetX=this.startX+a,this.offsetY=this.startY+b;for(var c=this.linkList,d=j.frags,e=0,f=c.length;f>e;e++)d[c[e]].offsetX=this.offsetX,d[c[e]].offsetY=this.offsetY;return{x:this.offsetX,y:this.offsetY}},g.isLinked=function(b){return-1!==a.inArray(b,this.linkList)},g.link=function(a,b){var c=this.linkList;c=c.concat(a[b].linkList);var d,e;for(d=0,e=c.length;e>d;d++)a[c[d]].linkList=c;return this.top(++j.moveElId),c.length},g.top=function(){var b=a(".frag-wr .frag");a(this.linkList).each(function(a,c){b.eq(c).css("z-index",j.moveElId+1)})};var h={el:a(".game-ctr .timer .value"),limit:0,timeId:0,result:0,reset:function(){if(h.el.text("00:00"),1===d.mode)switch(d.difficulty){case 1:h.limit=22;break;case 2:h.limit=180;break;case 3:h.limit=600}},normalize:function(a){var b=Math.floor(a/60),c=a%60;return b=("0"+b).substr(-2),c=("0"+c).substr(-2),b+":"+c},setDom:function(a){"string"!=typeof a&&(a=h.normalize(a)),h.el.text(a)},countDown:function(a,b){function c(){h.setDom(a),a--,h.result=a,0>a?b&&b():h.timeId=setTimeout(c,1e3)}clearTimeout(h.timeId),h.timeId=setTimeout(c,1e3)},count:function(){function a(){h.setDom(b),b++,h.result=b,h.timeId=setTimeout(a,1e3)}var b=0;clearTimeout(h.timeId),h.timeId=setTimeout(a,1e3)},stop:function(){clearTimeout(h.timeId)}},i=0,j={wr:a(".frag-wr"),imgIndex:1,moveElId:0,frags:[],col:0,row:0,size:0,nowDi:0,fire:function(){j.nowDi=d.difficulty,h.reset(),j.wr.css("margin-top",(e.h-460)/2+"px"),j.ready(),a(".container").removeClass("step2 show-btn"),a(".mode-btn-wr .btn").eq(0).one(Transitionend,function(){setTimeout(function(){j.wr.one(Transitionend,function(){a(".container").addClass("show-ctr")}),a(".container").addClass("step3")},10)})},ready:function(){function b(){c.text(d+"秒钟记图"),d--,0>d?j.messup():setTimeout(b,1e3)}j.frags=[],j.moveModule.list=[],j.imgIndex=j.nowDi,j.generateView();var c=a(".game-ctr .game-mode"),d=5;b()},messup:function(){rx=0,ry=0,c=0,r=0,col=j.col,row=j.row,size=j.size,frags=j.frags,pos={},els=a(".frag-wr .frag"),j.wr.addClass("ready"),d.setDom(),els.eq(0).one(Transitionend,function(){j.wr.removeClass("ready"),j.bind(),1===d.mode?h.countDown(h.limit,j.fail):(2===d.mode&&1===j.nowDi||3===d.mode)&&h.count()});for(var b=0,e=frags.length;e>b;b++)c=b%col,r=Math.floor(b/col),rx=Math.random()*(300-size),ry=Math.random()*(400-size),pos=frags[b].move(rx-c*size,ry-r*size),els.eq(b).css({"-webkit-transform":"translateX("+pos.x+"px) translateY("+pos.y+"px)",transform:"translateX("+pos.x+"px) translateY("+pos.y+"px)"})},generateView:function(){j.wr.empty();var a=0,c=j.nowDi;1===c?a=12:2===c?a=48:3===c&&(a=108);var d,e=100/c,f="",g=0,h=3*c;for(j.size=e,j.col=h,j.row=j.col/3*4;a>g;)d=new b(g,e,h),j.frags.push(d),f+=d.str,g++;j.wr.append(f)},bind:function(){var b=j.wr;b.on("touchstart",".frag",function(a){if(j.moveModule.list.length>0)return void a.preventDefault();var b=a.touches[0];j.moveModule.add(b.target,b.clientX,b.clientY,++j.moveElId)}),b.on("touchmove",".frag",function(a){var b=a.touches[0];j.drawId||(j.moveModule.move(b.target,b.clientX,b.clientY),j.detectCat(b.target))}),b.on("touchend touchcancel",".frag",function(){j.moveModule.remove()}),a(".game-ctr .back").one("touchstart",function(){confirm("确定返回吗？")&&(j.destroy(),d.ready())})},unbind:function(){j.wr.off(),a(".game-ctr .back").off()},detectCat:function(b){for(var c=a(b),d=+c.data("index"),e=(j.size,d%j.col),f=Math.floor(d/j.col),g=-1,h=-1,i=[[-1,0],[0,1],[1,0],[0,-1]],k=j.frags,l=1e4,m=1e4,o=-1,p=!1,q=0,r=i.length;r>q;q++)if(h=f+i[q][0],g=e+i[q][1],h>=0&&h<j.row&&g>=0&&g<j.col&&!k[d].isLinked(o=h*j.col+g)&&(l=Math.abs(k[o].offsetX-k[d].offsetX),m=Math.abs(k[o].offsetY-k[d].offsetY),5>l&&5>m)){if(k[d].link(k,o)===j.frags.length)return j.pass(),!0;n.play("oui"),p=!0}return!1},drawIndex:-1,drawId:0,draw:function(b,c){a(".test").text(new Date-i),j.drawIndex===b&&cancelAnimationFrame(j.drawId),j.drawIndex=b,j.drawId=requestAnimationFrame(function(){i=+new Date;var d=a(".frag-wr .frag");j.drawIndex=-1,j.drawId=0,a(j.frags[b].linkList).each(function(a,b){d.eq(b).css({"-webkit-transform":"translateX("+c.x+"px) translateY("+c.y+"px)",transform:"translateX("+c.x+"px) translateY("+c.y+"px)"})})})},moveModule:{list:[],add:function(b,c,d,e){var f=j.moveModule.list;if(!f.length){var g=+a(b).data("index"),h=j.frags[g];h.top(e+1),h.startX=h.offsetX,h.startY=h.offsetY,f[0]={tar:b,x:c,y:d,id:e}}},move:function(b,c,d){var e=j.moveModule.list;b=a(b);var f,g=-1;g=+b.data("index"),f=j.frags[g].move(c-e[0].x,d-e[0].y),j.draw(g,f)},remove:function(){j.moveModule.list=[]}},fail:function(){j.destroy(),k.show("so sad...时间已到~",1),n.play("fail")},pass:function(){2===d.mode&&j.nowDi<3?(j.nowDi++,requestAnimationFrame(function(){j.ready()})):(j.destroy(),k.show("通关成功！",2)),n.play("pass")},destroy:function(){j.unbind(),h.stop()}};a("body").on("touchmove",function(a){a.preventDefault()}),a("#start-btn").one("touchstart",d.ready);for(var k={el:a(".pop"),textel:a(".pop").find(".pop-card .text-wr"),btn:a(".pop .btn-wr"),show:function(a,b,c){if(k.textel.text(a),k.el.addClass("show"),"number"!=typeof b)k.hideBtn(),k.el.one("touchstart",function(){k.hide()}),c=b;else{k.showBtn();var d=k.btn.find("button");1===b?d.eq(0).text("找人帮忙"):2===b&&d.eq(0).text("低调秀一下"),k.bindBtn(b)}},hide:function(){k.el.removeClass("show")},hideBtn:function(){k.btn.css("display","none")},showBtn:function(){k.btn.css("display","block")},bindBtn:function(b){k.btn.on("touchstart",function(c){var e=c.target;if(a(e).hasClass("replay"))d.ready(),k.hide();else{if(!a(e).hasClass("share"))return;m.show(b,h.result)}})}},l={shareImageUrl:HOST+"/static/img/icon.jpg",bgs:[HOST+"/static/img/winnie1.jpg",HOST+"/static/img/winnie2.jpg",HOST+"/static/img/winnie3.jpg"]},m={data:{title:"拼出维尼熊",text:"我正在拼维尼熊，啊~！好喜欢维尼熊~",imageUrl:l.shareImageUrl},shareTpl:[{title:"拼出维尼熊",text:"So sad...我没能把高能维尼熊拼出来，求助大神~",imageUrl:l.shareImageUrl},{title:"拼出维尼熊",text:"So sad...我竟没能把中能维尼熊拼出来，求助大神~",imageUrl:l.shareImageUrl},{title:"拼出维尼熊",text:"So sad...我连低能维尼熊都没拼出来，我面壁去了",imageUrl:l.shareImageUrl},{title:"拼出维尼熊",text:"我在计时模式中拼出了$difficulty$的维尼熊，还剩$time$秒哦！",imageUrl:l.shareImageUrl},{title:"拼出维尼熊",text:"呕液~我花了$time$秒成功拼出了$difficulty$的维尼熊~求超越~",imageUrl:l.shareImageUrl},{title:"拼出维尼熊",text:"我花了$time$秒完成了进阶模式的维尼熊拼图，速来膜拜~",imageUrl:l.shareImageUrl}],show:function(a,b){a&&0!==a?1===a?m.setData(1):2===a&&m.setData(2,b):m.setData(0),yw.openSocialShareMenu(m.data,function(a,b){a&&k.show(b.toString())})},setData:function(b){var c={};if(0===b)a.extend(!0,c,m.shareTpl[0]);else if(1===b)switch(d.difficulty){case 1:a.extend(!0,c,m.shareTpl[1]);break;case 2:a.extend(!0,c,m.shareTpl[2]);break;case 3:a.extend(!0,c,m.shareTpl[3])}else if(2===b){switch(d.mode){case 1:a.extend(!0,c,m.shareTpl[4]);break;case 2:a.extend(!0,c,m.shareTpl[5]);break;case 3:a.extend(!0,c,m.shareTpl[6])}var e="";switch(d.difficulty){case 1:e="低能";break;case 2:e="中能";break;case 3:e="高能"}c.text=c.text.replace(/\$difficulty\$/g,e).replace(/\$time\$/g,h.result)}m.data=c}},n={playing:"",tracks:{oui:a("#audio-oui").get(0),fail:a("#audio-fail").get(0),pass:a("#audio-pass").get(0)},play:function(a){n.playing===a&&n.pause(),n.playing=a,n.tracks[a].play()},pause:function(){n.playing.length&&n.tracks[n.playing].pause()&&(n.tracks[n.playing].currentTime=0)}},o=0,p=l.bgs.length;p>o;o++)a(".preload").append("<img src='"+l.bgs[o]+"'>")});